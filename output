./diagnose_views.sh
================================================================================================
NETEZZA SYSTEM VIEWS DIAGNOSTIC
Testing which views are available for object ownership detection
================================================================================================

Using connection: nzsql -d SYSTEM -u ADMIN

Testing with user: USG75

--- Test 1: _V_RELATION_TABLE view ---
Query: SELECT COUNT(*) FROM _V_RELATION_TABLE WHERE OWNER = 'USG75';

✗ View does not exist or query failed
  Error: ERROR:  relation does not exist SYSTEM.ADMIN._V_RELATION_TABLE

--- Test 2: _V_RELATION_VIEW view ---
Query: SELECT COUNT(*) FROM _V_RELATION_VIEW WHERE OWNER = 'USG75';

✗ View does not exist or query failed
  Error: ERROR:  relation does not exist SYSTEM.ADMIN._V_RELATION_VIEW

--- Test 3: _V_RELATION_SEQUENCE view ---
Query: SELECT COUNT(*) FROM _V_RELATION_SEQUENCE WHERE OWNER = 'USG75';

✗ View does not exist or query failed
  Error: ERROR:  relation does not exist SYSTEM.ADMIN._V_RELATION_SEQUENCE

--- Test 4: _V_TABLE view (fallback) ---
Query: SELECT COUNT(*) FROM _V_TABLE WHERE OWNER = 'USG75';

✓ View exists and query succeeded
  Result: '     0'
  Trimmed: '0'

--- Test 5: List all available system views with 'RELATION' in name ---

          VIEWNAME          | DATABASE
----------------------------+----------
 _V_OBJ_RELATION            | SYSTEM
 _V_OBJ_RELATION_XDB        | SYSTEM
 _V_RELATION_COLUMN         | SYSTEM
 _V_RELATION_COLUMN_DEF     | SYSTEM
 _V_RELATION_COLUMN_DEF_XDB | SYSTEM
 _V_RELATION_COLUMN_XDB     | SYSTEM
 _V_RELATION_KEYDATA        | SYSTEM
 _V_RELATION_KEYDATA_XDB    | SYSTEM
 _V_SYS_RELATION            | SYSTEM
 _V_SYS_RELATION_XDB        | SYSTEM
(10 rows)


--- Test 6: Query system catalog for objects ---
Query: SELECT COUNT(*) FROM _T_OBJECT WHERE OWNER = 'USG75';

✗ System catalog query failed
  Error: ERROR:  Attribute 'OWNER' not found

--- Test 7: Test alternative view names ---

Testing: _V_OBJ_RELATION_XDB
  ✓ View exists: _V_OBJ_RELATION_XDB
    Objects for USG75: 3

Testing: _V_TABLE_XDB
  ✓ View exists: _V_TABLE_XDB
    Objects for USG75: 3

Testing: _V_RELATION
  ✗ View does not exist: _V_RELATION

--- Test 8: Show sample data from _V_RELATION_TABLE (if exists) ---

ERROR:  relation does not exist SYSTEM.ADMIN._V_RELATION_TABLE

--- Test 9: Verify database connection ---

ERROR:  Attribute 'CURRENT_DATABASE' not found

================================================================================================
DIAGNOSTIC SUMMARY
================================================================================================

Review the results above to determine:

1. Which views exist on your Netezza system
2. Whether _V_RELATION_* views are available
3. If views return NULL or actual counts
4. What alternative views can be used

If _V_RELATION_* views don't exist, the script needs to be updated to use:
  - _V_TABLE, _V_VIEW, _V_SEQUENCE (single database)
  - OR query each database separately
  - OR use _T_OBJECT system catalog directly

================================================================================================
